<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to ipfitr • ipfitr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">ipfitr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipfitr.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ryantimpe/ipfitr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to ipfitr</h1>
                        <h4 class="author">Ryan Timpe</h4>
            
            <h4 class="date">2018-01-31</h4>
          </div>

    
    
<div class="contents">
<p>In market sizing and forecasting, we’re often tasked with estimating large data tables with limited data or only tables of subtotals. For example, one might know the number of people employed in the a country by age range, as well as the gender breakdown of total employment without age. Using iterative proportion fitting with these two data series, one can estimate the number of people employed by age range AND gender.</p>
<p><a href="https://en.wikipedia.org/wiki/Iterative_proportional_fitting">Iterative proportion fitting</a> (IPF) has been used in market analysis for over 30 years. This package integrates the methodology, along with some more expansions of this technique, into the <a href="https://github.com/tidyverse/tidyverse">tidyverse</a> in R.</p>
<p>The ipfitr package for R allows the user to input multiple high-level summary/aggregate data tables and create a single, full-dimension data table estimating individual cell values using iterative proportion fitting.</p>
<div id="data-three-one-dimensional-targets" class="section level2">
<h2 class="hasAnchor">
<a href="#data-three-one-dimensional-targets" class="anchor"></a>Data: Three one-dimensional targets</h2>
<p>To explore the function in the ipfitr package, we’ll create three simple data frames to use as targets. Each target represents the total money spent at a fairground over the course of the weekend. <code>tar1</code> contains the money spent on each item at the fair; <code>tar2</code> contains the amount of money spent by each person; and <code>tar3</code> contains the daily totals. Note that the total of each of the three targets is equal, representing the total amount of money spent at the fair over the weekend.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tar1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">item =</span> <span class="kw">c</span>(<span class="st">"Attractions"</span>, <span class="st">"Balloons"</span>, <span class="st">"Candy"</span>),
  <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">80</span>),
  <span class="dt">stringsAsFactors =</span> F
)

tar2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">person =</span> <span class="kw">c</span>(<span class="st">"Abby"</span>, <span class="st">"Ben"</span>, <span class="st">"Charles"</span>, <span class="st">"Dexter"</span>),
  <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">70</span>, <span class="dv">90</span>, <span class="dv">110</span>, <span class="dv">80</span>),
  <span class="dt">stringsAsFactors =</span> F
)

tar3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">day =</span> <span class="kw">c</span>(<span class="st">"Friday"</span>, <span class="st">"Saturday"</span>, <span class="st">"Sunday"</span>),
  <span class="dt">value =</span> <span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">100</span>),
  <span class="dt">stringsAsFactors =</span> F
)</code></pre></div>
</div>
<div id="expanding-data-with-ip_expand" class="section level2">
<h2 class="hasAnchor">
<a href="#expanding-data-with-ip_expand" class="anchor"></a>Expanding data with ip_expand()</h2>
<p>The ipfitr package can be used to estimate how much money each person spent on each item over each of the days. This takes our 10 data points (3+4+3) and creates 36 data points (3x4x3), while ensuring the 10 target data points remain true.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tar_list &lt;-<span class="st"> </span><span class="kw">list</span>(tar1, tar2, tar3)

dat_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ip_expand.html">ip_expand</a></span>(tar_list)

<span class="kw">head</span>(dat_<span class="dv">1</span>)
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   item        person day    value</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Attractions Abby   Friday  6.86</span>
<span class="co">#&gt; 2 Balloons    Abby   Friday  8.57</span>
<span class="co">#&gt; 3 Candy       Abby   Friday  4.57</span>
<span class="co">#&gt; 4 Attractions Ben    Friday  8.82</span>
<span class="co">#&gt; 5 Balloons    Ben    Friday 11.0 </span>
<span class="co">#&gt; 6 Candy       Ben    Friday  5.88</span></code></pre></div>
<p><code><a href="../reference/ip_expand.html">ip_expand()</a></code> is a wrapper function, performing two key IPF functions in a single step. First, the function takes all the targets (3 here) and creates a “seed” data frame that contains all combinations of the unique series in the targets along with a seed value of 1. From there, a fitting function takes over, scaling the seed value iteratively to each of the targets until all targets are met.</p>
<p>This is equivalent to running the two functions independently:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ip_create_seed.html">ip_create_seed</a></span>(tar_list) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/ip_fit.html">ip_fit</a></span>(tar_list)</code></pre></div>
</div>
<div id="seeding-the-ipf-with-ip_create_seed" class="section level2">
<h2 class="hasAnchor">
<a href="#seeding-the-ipf-with-ip_create_seed" class="anchor"></a>Seeding the IPF with ip_create_seed()</h2>
<p>Initializing the seed values at 1 implies that one has no additional information about the relative distribution of the elements in the final output. In this example, the user has no additional information about the spending by each person on each item during each day of the weekend.</p>
<p>Alternatively, suppose you learn that Abby got her paycheck on Saturday, so most of her spending was on Saturday and Sunday rather than Friday. You can implement this vague piece of information using the seed. This information should impact spending on all items, so we can reduce all seed values for Abby on Friday by 50%.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ip_create_seed.html">ip_create_seed</a></span>(tar_list) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">value =</span> <span class="kw">ifelse</span>(person <span class="op">==</span><span class="st"> "Abby"</span> <span class="op">&amp;</span><span class="st"> </span>day <span class="op">==</span><span class="st"> "Friday"</span>, <span class="fl">0.5</span><span class="op">*</span>value, value)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/ip_fit.html">ip_fit</a></span>(tar_list)

dat_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(person <span class="op">==</span><span class="st"> "Abby"</span>,  day <span class="op">==</span><span class="st"> "Friday"</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   item        person day    value</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Attractions Abby   Friday  6.86</span>
<span class="co">#&gt; 2 Balloons    Abby   Friday  8.57</span>
<span class="co">#&gt; 3 Candy       Abby   Friday  4.57</span>

dat_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(person <span class="op">==</span><span class="st"> "Abby"</span>,  day <span class="op">==</span><span class="st"> "Friday"</span>)
<span class="co">#&gt; # A tibble: 3 x 4</span>
<span class="co">#&gt;   item        person day    value</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Attractions Abby   Friday  4.42</span>
<span class="co">#&gt; 2 Balloons    Abby   Friday  5.53</span>
<span class="co">#&gt; 3 Candy       Abby   Friday  2.95</span></code></pre></div>
<p>You’ll notice that reducing Abby’s seed on Friday by 50% does reduce the final spending estimates, but by less than 50%. The seed informs the intial starting point for Abby’s Friday spending compared to her spending on other days, as well as Abby’s spending on Friday relative to the other visitors’ spending on Friday. From there, the scaling take over, ensuring all the targets are hit.</p>
<p>The seed value do not need to be based around 1 - any non-negative values will work. For example, you could use spending estimates of the fairground attendees from a previous visit as the seed for this visit.</p>
<p>Any seed values of 0 will remain 0 in the final IPF outputt.</p>
</div>
<div id="masking-the-seed-with-ip_mask_seed" class="section level2">
<h2 class="hasAnchor">
<a href="#masking-the-seed-with-ip_mask_seed" class="anchor"></a>Masking the seed with ip_mask_seed()</h2>
</div>
<div id="implementing-specific-information-with-ip_fit" class="section level2">
<h2 class="hasAnchor">
<a href="#implementing-specific-information-with-ip_fit" class="anchor"></a>Implementing specific information with ip_fit()</h2>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-three-one-dimensional-targets">Data: Three one-dimensional targets</a></li>
      <li><a href="#expanding-data-with-ip_expand">Expanding data with ip_expand()</a></li>
      <li><a href="#seeding-the-ipf-with-ip_create_seed">Seeding the IPF with ip_create_seed()</a></li>
      <li><a href="#masking-the-seed-with-ip_mask_seed">Masking the seed with ip_mask_seed()</a></li>
      <li><a href="#implementing-specific-information-with-ip_fit">Implementing specific information with ip_fit()</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ryan Timpe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
